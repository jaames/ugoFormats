/*!
 * ugo-formats.js v1.0.0
 * 2018 James Daniel
 * Released under the MIT License
 * github.com/jaames
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ugoFormats=e()}(this,function(){"use strict";function t(t){var e=new Uint32Array(t.length);return t.forEach(function(t,i){var r=31&t,n=t>>5&31,s=t>>10&31,o=t>>15&1;r=r<<3|r>>2,n=n<<3|n>>2,s=s<<3|s>>2,o=0==o?0:255,e[i]=o<<24|r<<16|n<<8|s}),e}function e(t){var e=new Uint32Array(t,0,2),i=e[0],r=e[1];return 1380009813!==i?null:new Uint32Array(t,8,r)}function i(t){var e=window.atob(t),i=new Uint8Array(e.length);return i=i.map(function(t,i){return e.charCodeAt(i)}),String.fromCharCode.apply(null,new Uint16Array(i.buffer))}function r(t){if(t&t-1==0)return t;for(var e=1;1<<e<t;)e+=1;return 1<<e}function n(t,e){return Math.ceil(t/e)*e}function s(t){return new Promise(function(e,i){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onreadystatechange=function(t){4===r.readyState&&(r.status>=200&&r.status<300?e(r.response):i({type:"httpError",status:r.status,statusText:r.statusText}))},r.send(null)})}var o=function(t,e,i){this.width=t,this.height=e,this.vWidth=n(t,4),this.vHeight=n(e,4),this.bpp=i,this.fileHeader=new DataView(new ArrayBuffer(14)),this.fileHeader.setUint16(0,16973),this.dibHeader=new DataView(new ArrayBuffer(40)),this.dibHeader.setUint32(0,40,!0),this.dibHeader.setInt32(4,t,!0),this.dibHeader.setInt32(8,e,!0),this.dibHeader.setUint16(12,1,!0),this.dibHeader.setUint16(14,i,!0),this.dibHeader.setUint32(16,0,!0),this.dibHeader.setUint32(20,this.vWidth*this.height/i,!0),this.dibHeader.setUint32(24,3780,!0),this.dibHeader.setUint32(28,3780,!0),this.dibHeader.setUint32(32,0,!0),this.dibHeader.setUint32(36,0,!0)};o.prototype.setPalette=function(t){for(var e=Math.pow(2,this.bpp),i=new Uint32Array(e),r=0;r<i.length;r++)i[r]=t[r%t.length];this.palette=i},o.prototype.setPixels=function(t){var e,i=this.vWidth*this.height;switch(this.bpp){case 8:e=new Uint8Array(i);break;case 32:e=new Uint32Array(i)}for(var n=r(this.width),s=0;s<this.height;s++){var o=n*this.height-(s+1)*n,a=s*this.width;e.set(t.slice(o,o+this.width),a)}this.pixels=e},o.prototype.getBlob=function(){var t=[this.fileHeader.buffer,this.dibHeader.buffer],e=this.fileHeader.byteLength+this.dibHeader.byteLength;switch(this.bpp){case 1:case 4:case 8:this.fileHeader.setUint32(2,e+this.pixels.byteLength+this.palette.byteLength,!0),this.fileHeader.setUint32(10,e+this.palette.byteLength,!0),t=t.concat([this.palette.buffer,this.pixels.buffer]);break;case 16:case 32:this.fileHeader.setUint32(2,e+this.pixels.byteLength,!0),this.fileHeader.setUint32(10,e,!0),t=t.concat([this.pixels.buffer])}return new Blob(t,{type:"image/bitmap"})},o.prototype.getUrl=function(){return window.URL.createObjectURL(this.getBlob())},o.prototype.getImage=function(){var t=new Image(this.width,this.height);return t.src=this.getUrl(),t};var a=function(t,e){this.buffer=t,this.PIXEL_TYPE=e};a.fetch=function(t){var e=this;return s(t).then(function(t){return new e(t)})},a.prototype.getImage=function(t,e){return this.getBitmap(t,e).getImage()},a.prototype.getImageUrl=function(t,e){return this.getBitmap(t,e).getUrl()},a.prototype.getImageBlob=function(t,e){return this.getBitmap(t,e).getBlob()},a.prototype.getBitmap=function(t,e){if("P"==this.PIXEL_TYPE){var i=new o(t,e,8);return i.setPalette(this.getPalette()),i.setPixels(this.getPixels()),i}if("RGBA"==this.PIXEL_TYPE){var r=new o(t,e,32);return r.setPixels(this.getPixels()),r}};var h=function(e){function i(t){e.call(this,t,"RGBA")}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.getPixels=function(){return t(new Uint16Array(this.buffer))},i}(a),u=function(i){function n(t){i.call(this,t,"P"),this.sections=e(t),this.sections[0]=r(this.sections[0])}return i&&(n.__proto__=i),n.prototype=Object.create(i&&i.prototype),n.prototype.constructor=n,n.prototype.getPalette=function(){return t(new Uint16Array(this.buffer,16,this.sections[0]))},n.prototype.getPixels=function(){return new Uint8Array(this.buffer,16+this.sections[0],this.sections[1])},n}(a),p=function(i){function n(t){i.call(this,t,"P"),this.sections=e(t),this.sections[0]=r(this.sections[0])}return i&&(n.__proto__=i),n.prototype=Object.create(i&&i.prototype),n.prototype.constructor=n,n.prototype.getPalette=function(){var e=t(new Uint16Array(this.buffer,16,this.sections[0]));return e[0]=4294967040,e},n.prototype.getPixels=function(){for(var t=new Uint8Array(this.buffer,16+this.sections[0],this.sections[1]),e=new Uint8Array(2*t.length),i=0,r=0;i<t.length;i+=1,r+=2){var n=t[i];e[r]=15&n,e[r+1]=n>>4&15}return e},n}(a),c=new Uint32Array([4294967295,4283585106,4294967295,4289045925,4294901760,4286251008,4294933371,4278255360,4278190335,4278190203,4286282751,4278255360,4294902015,4278255360,4278255360,4278255360]),f=function(t){function e(e){t.call(this,e,"P")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getImage=function(){return t.prototype.getImage.call(this,64,48)},e.prototype.getImageUrl=function(){return t.prototype.getImageUrl.call(this,64,48)},e.prototype.getImageBlob=function(){return t.prototype.getImageBlob.call(this,64,48)},e.prototype.getPalette=function(){return c},e.prototype.getPixels=function(){for(var t=new Uint8Array(this.buffer,160,1536),e=0,i=new Uint8Array(2*t.length),r=0;r<48;r++)for(var n=r%8*8,s=8*Math.floor(r/8),o=0;o<8;o++)for(var a=0;a<8;a+=2){var h=64*(s+o)+(n+a),u=t[e];i[h+1]=u>>4&15,i[h+0]=15&u,e+=1}return i},e}(a),l=function(t){this.buffer=t,this.sections=e(t);var i=String.fromCharCode.apply(null,new Uint8Array(t,8+this.sections.byteLength,this.sections[0]));this.contents=i.split("\n").map(function(t){return new g(t)});var r=this.contents.filter(function(t){return"LAYOUT"==t.type})[0];if(r&&(this.layoutType=r.layoutType,this.layoutVariant=r.layoutVariant),this.embeds=[],this.sections.length>1)for(var s=2==this.layoutType?1696:2048,o=n(16+this.sections[0],4),a=o+this.sections[1],h=o;h<a;h+=s){var u=this.buffer.slice(h,h+s);this.embeds.push(2==this.layoutType?new f(u):new y(u))}};l.fetch=function(t){var e=this;return s(t).then(function(t){return new e(t)})},l.prototype.getLayout=function(){return this.contents.filter(function(t){return"LAYOUT"==t.type})},l.prototype.getMeta=function(){return this.contents.filter(function(t){return"META"==t.type})},l.prototype.getDropdowns=function(){return this.contents.filter(function(t){return"DROPDOWN"==t.type})},l.prototype.getButtons=function(){return this.contents.filter(function(t){return"BUTTON"==t.type})},l.prototype.getMenuItems=function(){return this.contents.filter(function(t){return"MENU_ITEM"==t.type})};var y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getImage=function(){return t.prototype.getImage.call(this,32,32)},e}(h),g=function(t){var e=t.split("\t"),r=parseInt(e[0]);if(0==r)this.type="LAYOUT",this.layoutType=parseInt(e[1]),this.layoutVariant=parseInt(e[2])||void 0;else if(1==r){this.type="META";var n=parseInt(e[1]);this.upperlink=n?e[2]:void 0,this.uppertitle=n?void 0:i(e[2]),this.uppersubleft=n?void 0:i(e[3]),this.uppersubright=n?void 0:i(e[4]),this.uppersubtop=n?void 0:i(e[5]),this.uppersubbottom=n?void 0:i(e[6])}else 2==r?(this.type="DROPDOWN",this.url=e[1],this.label=i(e[2]),this.isSelected="1"===e[3]):3==r?(this.type="BUTTON",this.url=e[1],this.label=i(e[2])):4==r&&(this.type="MENU_ITEM",this.url=e[1],this.icon=parseInt(e[2]),this.label=i(e[3]),this.counter=parseInt(e[4])||void 0,this.lock="1"==e[5],this.unknown=e[6])};return{NtftImage:h,NbfImage:u,NpfImage:p,TmbImage:f,UgoMenu:l}});
//# sourceMappingURL=ugo-formats.min.js.map
