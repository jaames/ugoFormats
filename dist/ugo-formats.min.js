/*!
 * ugo-formats.js v1.1.0
 * 2018 James Daniel
 * Released under the MIT License
 * github.com/jaames
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ugoFormats=e()}(this,function(){"use strict";function t(t){var e=new Uint32Array(t.length);return t.forEach(function(t,i){var n=31&t,r=t>>5&31,s=t>>10&31,o=t>>15&1;n=n<<3|n>>2,r=r<<3|r>>2,s=s<<3|s>>2,o=0==o?0:255,e[i]=o<<24|n<<16|r<<8|s}),e}function e(t){var e=new Uint32Array(t,0,2),i=e[0],n=e[1];return 1380009813!==i?null:new Uint32Array(t,8,n)}function i(t){var e=window.atob(t),i=new Uint8Array(e.length);return i=i.map(function(t,i){return e.charCodeAt(i)}),String.fromCharCode.apply(null,new Uint16Array(i.buffer))}function n(t){if(t&t-1==0)return t;for(var e=1;1<<e<t;)e+=1;return 1<<e}function r(t,e){return Math.ceil(t/e)*e}function s(t){return new Promise(function(e,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onreadystatechange=function(t){4===n.readyState&&(n.status>=200&&n.status<300?e(n.response):i({type:"httpError",status:n.status,statusText:n.statusText}))},n.send(null)})}var o=function(t,e,i){this.width=t,this.height=e,this.vWidth=r(t,4),this.vHeight=r(e,4),this.bpp=i,this.fileHeader=new DataView(new ArrayBuffer(14)),this.fileHeader.setUint16(0,16973),this.dibHeader=new DataView(new ArrayBuffer(108)),this.dibHeader.setUint32(0,108,!0),this.dibHeader.setInt32(4,t,!0),this.dibHeader.setInt32(8,e,!0),this.dibHeader.setUint16(12,1,!0),this.dibHeader.setUint16(14,i,!0),this.dibHeader.setUint32(16,3,!0),this.dibHeader.setUint32(20,this.vWidth*this.height/(i/8),!0),this.dibHeader.setUint32(24,3780,!0),this.dibHeader.setUint32(28,3780,!0),this.dibHeader.setUint32(32,0,!0),this.dibHeader.setUint32(36,0,!0),this.dibHeader.setUint32(40,16711680,!0),this.dibHeader.setUint32(44,65280,!0),this.dibHeader.setUint32(48,255,!0),this.dibHeader.setUint32(52,4278190080,!0),this.dibHeader.setUint32(56,544106839,!0)};o.prototype.setFilelength=function(t){this.fileHeader.setUint32(2,t,!0)},o.prototype.setPixelOffset=function(t){this.fileHeader.setUint32(10,t,!0)},o.prototype.setCompression=function(t){this.dibHeader.setUint32(16,t,!0)},o.prototype.setPaletteCount=function(t){this.dibHeader.setUint32(32,t,!0)},o.prototype.setPalette=function(t){for(var e=Math.pow(2,this.bpp),i=new Uint32Array(e),n=0;n<i.length;n++)i[n]=t[n%t.length];this.setPaletteCount(e),this.setCompression(0),this.palette=i},o.prototype.setPixels=function(t){var e,i=this.vWidth*this.height;switch(this.bpp){case 8:e=new Uint8Array(i);break;case 32:e=new Uint32Array(i)}for(var r=n(this.width),s=0;s<this.height;s++){var o=r*this.height-(s+1)*r,h=s*this.width;e.set(t.slice(o,o+this.width),h)}this.pixels=e},o.prototype.getBlob=function(){var t=[this.fileHeader.buffer,this.dibHeader.buffer],e=this.fileHeader.byteLength+this.dibHeader.byteLength;switch(this.bpp){case 1:case 4:case 8:this.setFilelength(e+this.pixels.byteLength+this.palette.byteLength),this.setPixelOffset(e+this.palette.byteLength),t=t.concat([this.palette.buffer,this.pixels.buffer]);break;case 16:case 32:this.setFilelength(e+this.pixels.byteLength),this.setPixelOffset(e),t=t.concat([this.pixels.buffer])}return new Blob(t,{type:"image/bitmap"})},o.prototype.getUrl=function(){return window.URL.createObjectURL(this.getBlob())},o.prototype.getImage=function(){var t=new Image(this.width,this.height);return t.src=this.getUrl(),t};var h=function(t,e){this.buffer=t,this.PIXEL_TYPE=e};h.fetch=function(t){var e=this;return s(t).then(function(t){return new e(t)})},h.prototype.getImage=function(t,e){return this.getBitmap(t,e).getImage()},h.prototype.getImageUrl=function(t,e){return this.getBitmap(t,e).getUrl()},h.prototype.getImageBlob=function(t,e){return this.getBitmap(t,e).getBlob()},h.prototype.getBitmap=function(t,e){if("P"==this.PIXEL_TYPE){var i=new o(t,e,8);return i.setPalette(this.getPalette()),i.setPixels(this.getPixels()),i}if("RGBA"==this.PIXEL_TYPE){var n=new o(t,e,32);return n.setPixels(this.getPixels()),n}};var a=function(e){function i(t){e.call(this,t,"RGBA")}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.getPixels=function(){return t(new Uint16Array(this.buffer))},i}(h),p=function(i){function r(t){i.call(this,t,"P"),this.sections=e(t),this.sections[0]=n(this.sections[0])}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.getPalette=function(){return t(new Uint16Array(this.buffer,16,this.sections[0]))},r.prototype.getPixels=function(){return new Uint8Array(this.buffer,16+this.sections[0],this.sections[1])},r}(h),u=function(i){function r(t){i.call(this,t,"P"),this.sections=e(t),this.sections[0]=n(this.sections[0])}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.getPalette=function(){var e=t(new Uint16Array(this.buffer,16,this.sections[0]));return e[0]=4294967040,e},r.prototype.getPixels=function(){for(var t=new Uint8Array(this.buffer,16+this.sections[0],this.sections[1]),e=new Uint8Array(2*t.length),i=0,n=0;i<t.length;i+=1,n+=2){var r=t[i];e[n]=15&r,e[n+1]=r>>4&15}return e},r}(h),f=new Uint32Array([4294967295,4283585106,4294967295,4289045925,4294901760,4286251008,4294933371,4278255360,4278190335,4278190203,4286282751,4278255360,4294902015,4278255360,4278255360,4278255360]),c=function(t){function e(e){t.call(this,e,"P")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getImage=function(){return t.prototype.getImage.call(this,64,48)},e.prototype.getImageUrl=function(){return t.prototype.getImageUrl.call(this,64,48)},e.prototype.getImageBlob=function(){return t.prototype.getImageBlob.call(this,64,48)},e.prototype.getPalette=function(){return f},e.prototype.getPixels=function(){for(var t=new Uint8Array(this.buffer,160,1536),e=0,i=new Uint8Array(2*t.length),n=0;n<48;n++)for(var r=n%8*8,s=8*Math.floor(n/8),o=0;o<8;o++)for(var h=0;h<8;h+=2){var a=64*(s+o)+(r+h),p=t[e];i[a+1]=p>>4&15,i[a+0]=15&p,e+=1}return i},e}(h),l=function(t){this.buffer=t,this.sections=e(t);var i=String.fromCharCode.apply(null,new Uint8Array(t,8+this.sections.byteLength,this.sections[0]));this.contents=i.split("\n").map(function(t){return new g(t)});var n=this.contents.filter(function(t){return"LAYOUT"==t.type})[0];if(n&&(this.layoutType=n.layoutType,this.layoutVariant=n.layoutVariant),this.embeds=[],this.sections.length>1)for(var s=2==this.layoutType?1696:2048,o=r(16+this.sections[0],4),h=o+this.sections[1],a=o;a<h;a+=s){var p=this.buffer.slice(a,a+s);this.embeds.push(2==this.layoutType?new c(p):new y(p))}};l.fetch=function(t){var e=this;return s(t).then(function(t){return new e(t)})},l.prototype.getLayout=function(){return this.contents.filter(function(t){return"LAYOUT"==t.type})},l.prototype.getMeta=function(){return this.contents.filter(function(t){return"META"==t.type})},l.prototype.getDropdowns=function(){return this.contents.filter(function(t){return"DROPDOWN"==t.type})},l.prototype.getButtons=function(){return this.contents.filter(function(t){return"BUTTON"==t.type})},l.prototype.getMenuItems=function(){return this.contents.filter(function(t){return"MENU_ITEM"==t.type})};var y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getImage=function(){return t.prototype.getImage.call(this,32,32)},e}(a),g=function(t){var e=t.split("\t"),n=parseInt(e[0]);if(0==n)this.type="LAYOUT",this.layoutType=parseInt(e[1]),this.layoutVariant=parseInt(e[2])||void 0;else if(1==n){this.type="META";var r=parseInt(e[1]);this.upperlink=r?e[2]:void 0,this.uppertitle=r?void 0:i(e[2]),this.uppersubleft=r?void 0:i(e[3]),this.uppersubright=r?void 0:i(e[4]),this.uppersubtop=r?void 0:i(e[5]),this.uppersubbottom=r?void 0:i(e[6])}else 2==n?(this.type="DROPDOWN",this.url=e[1],this.label=i(e[2]),this.isSelected="1"===e[3]):3==n?(this.type="BUTTON",this.url=e[1],this.label=i(e[2])):4==n&&(this.type="MENU_ITEM",this.url=e[1],this.icon=parseInt(e[2]),this.label=i(e[3]),this.counter=parseInt(e[4])||void 0,this.lock="1"==e[5],this.unknown=e[6])};return{NtftImage:a,NbfImage:p,NpfImage:u,TmbImage:c,UgoMenu:l}});
//# sourceMappingURL=ugo-formats.min.js.map
